<!DOCTYPE html>
<html lang="{{ 'kk' if current_lang == 'kz' else 'ru' }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}Студент{% endblock %} · Портал</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="bg-light">
  <header class="py-3">
    <div class="container-xxl">
      <div class="d-flex align-items-center justify-content-between glass px-3 py-2 rounded-4 shadow-sm">
        <a class="text-decoration-none d-flex align-items-center gap-3" href="{{ url_for('student_dashboard') }}">
          <span class="brand-pill"><i class="bi bi-mortarboard"></i> Портал</span>
          <div class="d-none d-md-block">
            <div class="fw-bold text-dark mb-0">Добро пожаловать!</div>
            <small class="text-muted">Доступ к материалам, тестам и аналитике</small>
          </div>
        </a>
        <div class="d-flex align-items-center gap-2">
          <div class="btn-group btn-group-sm" role="group" aria-label="Language">
            <a class="btn btn-light border-0 {% if current_lang == 'kz' %}active{% endif %}" href="{{ url_for('set_lang', lang='kz', next=request.full_path) }}">Қаз</a>
            <a class="btn btn-light border-0 {% if current_lang == 'ru' %}active{% endif %}" href="{{ url_for('set_lang', lang='ru', next=request.full_path) }}">Рус</a>
          </div>
          {% if session.get('user') %}
          <span class="badge-soft d-none d-md-inline-flex align-items-center gap-2">
            <i class="bi bi-person-circle"></i>{{ session.get('user') }}
          </span>
          <a class="btn btn-outline-primary btn-sm" href="{{ url_for('logout') }}">Выход</a>
          <button class="btn btn-light btn-sm d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#studentSideNav" aria-controls="studentSideNav" aria-label="Меню">
            <i class="bi bi-list"></i>
          </button>
          {% endif %}
        </div>
      </div>
    </div>
  </header>

  <div class="container-xxl py-3">
    <div class="row g-3">
      {% if session.get('user') %}
      <nav id="studentSideNav" class="col-lg-3 col-xl-2 d-lg-block nav-rail min-vh-100 offcanvas-lg offcanvas-start rounded-4" tabindex="-1">
        <div class="offcanvas-header d-lg-none">
          <h5 class="offcanvas-title">Меню</h5>
          <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body p-2">
          <div class="surface p-3 mb-3">
            <div class="d-flex align-items-center gap-2 mb-2">
              <div class="icon-badge"><i class="bi bi-person"></i></div>
              <div>
                <div class="fw-semibold">{{ (current_student.name if current_student) or session.get('user') }}</div>
                <div class="text-muted small">
                  {% if current_student and current_student.group %}
                    {{ current_student.group.name }}
                  {% else %}
                    Студент
                  {% endif %}
                </div>
              </div>
            </div>
            <a class="btn btn-outline-primary btn-sm w-100" href="{{ url_for('student_profile') }}"><i class="bi bi-person-lines-fill me-1"></i>Профиль</a>
            <hr class="my-3">
            <ul class="nav flex-column student-nav">
              <li class="nav-item"><a class="nav-link {% if request.endpoint == 'student_dashboard' %}active{% endif %}" href="{{ url_for('student_dashboard') }}"><i class="bi bi-speedometer2"></i>Дашборд</a></li>
              <li class="nav-item"><a class="nav-link {% if request.endpoint == 'student_materials' %}active{% endif %}" href="{{ url_for('student_materials') }}"><i class="bi bi-folder2-open"></i>Материалы</a></li>
              <li class="nav-item"><a class="nav-link {% if request.endpoint in ['available_tests', 'start_test', 'submit_test'] %}active{% endif %}" href="{{ url_for('available_tests') }}"><i class="bi bi-ui-checks-grid"></i>Тесты</a></li>
              <li class="nav-item"><a class="nav-link {% if request.endpoint in ['homework', 'homework_submit'] %}active{% endif %}" href="{{ url_for('homework') }}"><i class="bi bi-journal-check"></i>Домашние задания</a></li>
              <li class="nav-item"><a class="nav-link {% if request.endpoint == 'student_analytics' %}active{% endif %}" href="{{ url_for('student_analytics') }}"><i class="bi bi-activity"></i>Аналитика</a></li>
              <li class="nav-item"><a class="nav-link {% if request.endpoint in ['ai_test', 'ai_result'] %}active{% endif %}" href="{{ url_for('ai_test') }}"><i class="bi bi-stars"></i>AI Опрос</a></li>
            </ul>
          </div>
        </div>
      </nav>
      {% endif %}

      <main class="{{ 'col-12' if not session.get('user') else 'col-lg-9 col-xl-10' }}">
        {% with messages = get_flashed_messages() %}
          {% if messages %}
            <div class="alert alert-info glass border-0">{{ messages[0] }}</div>
          {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
      </main>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
