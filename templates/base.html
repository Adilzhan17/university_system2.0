<!DOCTYPE html>
<html lang="{{ 'kk' if current_lang == 'kz' else 'ru' }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Образовательный центр{% endblock %} · ЕНТ Подготовка</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    {% block extra_head %}{% endblock %}
    <style>
        .brand-badge { width: 32px; height: 32px; border-radius: 8px; background: var(--bs-primary); color: #fff; display: inline-flex; align-items: center; justify-content: center; font-weight: 700; margin-right: .5rem; }
        .navbar-brand small { opacity: .7; font-weight: 500; }
        .flash-container .alert { margin-bottom: .5rem; }
        .surface { background: #fff; border: 1px solid rgba(0,0,0,.06); border-radius: .75rem; padding: 1rem; }
        body { font-family: 'Manrope', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
        .navbar-dark { background: linear-gradient(120deg, var(--brand-1), var(--brand-2)); }
    </style>
    {% block head_scripts %}{% endblock %}
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
</head>
<body class="bg-light">
    {% if request.endpoint != 'login' %}
    <header class="py-3">
      <div class="container-xxl">
        <div class="d-flex align-items-center justify-content-between glass px-3 py-2 rounded-4 shadow-sm">
          <a class="text-decoration-none d-flex align-items-center gap-3" href="{{ url_for('dashboard') }}">
            <span class="brand-pill"><i class="bi bi-mortarboard"></i> ЕНТ</span>
            <div class="d-none d-md-block">
              <div class="fw-bold text-dark mb-0">Образовательный центр</div>
              <small class="text-muted">Подготовка к ЕНТ и сопровождение студентов</small>
            </div>
          </a>
          <div class="d-flex align-items-center gap-2">
            <button class="btn btn-light btn-sm border-0" id="themeToggle" type="button" title="Тема">
              <i class="bi bi-moon-stars"></i>
            </button>
            <div class="btn-group btn-group-sm" role="group" aria-label="Language">
              <a class="btn btn-light border-0 {% if current_lang == 'kz' %}active{% endif %}" href="{{ url_for('set_lang', lang='kz', next=request.full_path) }}">Қаз</a>
              <a class="btn btn-light border-0 {% if current_lang == 'ru' %}active{% endif %}" href="{{ url_for('set_lang', lang='ru', next=request.full_path) }}">Рус</a>
            </div>
            {% if session.get('user') %}
            <span class="badge-soft d-none d-md-inline-flex align-items-center gap-2">
              <i class="bi bi-person-circle"></i>{{ session.get('user') }}
            </span>
            <a class="btn btn-outline-primary btn-sm" href="{{ url_for('logout') }}"><i class="bi bi-box-arrow-right me-1"></i>Выход</a>
            {% endif %}
            <button class="btn btn-light btn-sm d-lg-none menu-toggle" type="button" data-bs-toggle="offcanvas" data-bs-target="#sideNav" aria-controls="sideNav" aria-label="Меню">
              <i class="bi bi-list"></i>
              <span class="d-none d-sm-inline">Меню</span>
            </button>
          </div>
        </div>
      </div>
    </header>
    {% endif %}

    <div class="container-xxl">
      <div class="row g-3">
        {% if request.endpoint != 'login' %}
        <nav id="sideNav" class="col-lg-2 col-xl-2 d-lg-block nav-rail min-vh-100 offcanvas-lg offcanvas-start rounded-4" tabindex="-1">
          <div class="offcanvas-header d-lg-none">
            <h5 class="offcanvas-title">Меню</h5>
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body p-2">
            {% set role = current_user_obj.role if current_user_obj else None %}
            <ul class="nav flex-column py-2">
              <li class="nav-item"><a class="nav-link {% if request.endpoint == 'dashboard' %}active{% endif %}" href="{{ url_for('dashboard') }}"><i class="bi bi-speedometer2"></i>Главная</a></li>
              {% if role in ['admin', 'teacher'] %}
              <li class="nav-item"><a class="nav-link {% if request.endpoint == 'students' %}active{% endif %}" href="{{ url_for('students') }}"><i class="bi bi-people"></i>Студенты</a></li>
              <li class="nav-item"><a class="nav-link {% if request.endpoint == 'groups' %}active{% endif %}" href="{{ url_for('groups') }}"><i class="bi bi-diagram-3"></i>Группы</a></li>
              <li class="nav-item"><a class="nav-link {% if request.endpoint == 'courses' %}active{% endif %}" href="{{ url_for('courses') }}"><i class="bi bi-journal-text"></i>Курсы</a></li>
              <li class="nav-item"><a class="nav-link {% if request.endpoint == 'lectures' %}active{% endif %}" href="{{ url_for('lectures') }}"><i class="bi bi-mic"></i>{{ 'Мұғалімдер' if current_lang == 'kz' else 'Учителя' }}</a></li>
              <li class="nav-item"><a class="nav-link {% if request.endpoint == 'course_registration' %}active{% endif %}" href="{{ url_for('course_registration') }}"><i class="bi bi-clipboard-check"></i>Запись на курс</a></li>
              <li class="nav-item"><a class="nav-link {% if request.endpoint == 'materials' %}active{% endif %}" href="{{ url_for('materials') }}"><i class="bi bi-folder2-open"></i>Материалы</a></li>
              <li class="nav-item"><a class="nav-link {% if request.endpoint == 'tests' or request.endpoint == 'available_tests' %}active{% endif %}" href="{{ url_for('tests') }}"><i class="bi bi-ui-checks-grid"></i>Тесты</a></li>
              <li class="nav-item"><a class="nav-link {% if request.endpoint in ['homework', 'homework_submit'] %}active{% endif %}" href="{{ url_for('homework') }}"><i class="bi bi-journal-check"></i>Домашние задания</a></li>
              <li class="nav-item"><a class="nav-link {% if request.endpoint in ['ai_test','ai_result'] %}active{% endif %}" href="{{ url_for('ai_test') }}"><i class="bi bi-stars"></i>AI Опрос</a></li>
              {% endif %}
              {% if role == 'admin' %}
              <li class="nav-item"><a class="nav-link {% if request.endpoint == 'employees' %}active{% endif %}" href="{{ url_for('employees') }}"><i class="bi bi-person-workspace"></i>Сотрудники</a></li>
              <li class="nav-item"><a class="nav-link {% if request.endpoint == 'departments' %}active{% endif %}" href="{{ url_for('departments') }}"><i class="bi bi-building"></i>Отделы</a></li>
              <li class="nav-item"><a class="nav-link {% if request.endpoint == 'users_admin' %}active{% endif %}" href="{{ url_for('users_admin') }}"><i class="bi bi-people-fill"></i>Пользователи</a></li>
              {% endif %}
            </ul>
          </div>
        </nav>
        {% endif %}

        <main class="{{ 'col-12 p-0' if request.endpoint == 'login' else 'col-lg-10 col-xl-10 py-4' }}">
          <div id="toastContainer" class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1080;"></div>
          {% with messages = get_flashed_messages() %}
            {% if messages %}
              <div id="_flash_messages" class="d-none">{% for message in messages %}<div class="_msg">{{ message }}</div>{% endfor %}</div>
            {% endif %}
          {% endwith %}
          {% block content %}{% endblock %}
          {% if request.endpoint != 'login' %}
          <footer class="pt-4 text-muted small">
            <div>Образовательный центр подготовки к ЕНТ</div>
          </footer>
          {% endif %}
        </main>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
    {% block body_scripts %}{% endblock %}
</body>
</html>
